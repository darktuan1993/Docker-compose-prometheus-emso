groups:
- name: server-status
  rules:
  - alert: STATUS SERVER
    expr: up == 0
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "Máy chủ {{ $labels.instance }} bị tắt"
      description: "Hệ thống phát hiện máy chủ {{ $labels.instance }} đã ngừng phản hồi trong hơn 2 phút. Vui lòng kiểm tra tình trạng kết nối hoặc dịch vụ."

  - alert: CPU SERVER
    expr: 100 - avg by (instance,job,hostname,env) (irate(node_cpu_seconds_total{mode="idle"}[2m])) * 100 > 27
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "Máy chủ {{ $labels.instance }} sử dụng CPU cao trong 5 phút"
      description: "Mức sử dụng CPU của máy chủ {{ $labels.instance }} đã vượt quá 95% trong 5 phút. Giá trị hiện tại: {{ $value }}%"

  - alert: RAM SERVER
    expr: (node_memory_MemTotal_bytes - (node_memory_MemFree_bytes + node_memory_Cached_bytes + node_memory_Buffers_bytes)) / node_memory_MemTotal_bytes * 100 > 95
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "Máy chủ {{ $labels.instance }} sử dụng RAM cao trong 5 phút"
      description: "Mức sử dụng RAM của máy chủ {{ $labels.instance }} đã vượt quá 95% trong 5 phút. Giá trị hiện tại: {{ $value }}%"
